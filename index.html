<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cek Cuaca</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif; padding:24px; background:#f7f7f8;}
    .wrap{max-width:680px;margin:auto}
    .search{
      display:flex; gap:8px; margin-bottom:16px;
      background:#fff; padding:10px; border-radius:12px; box-shadow:0 4px 14px rgba(0,0,0,.06);
    }
    .search input{
      flex:1; border:1px solid #e6e6e6; border-radius:10px; padding:12px 14px; font-size:16px; outline:none;
    }
    .search button{
      border:0; padding:12px 16px; border-radius:10px; cursor:pointer; font-weight:600;
      background:#111; color:#fff;
    }
    .card{
      background:#fff; border-radius:18px; padding:20px; 
      box-shadow:0 10px 24px rgba(0,0,0,.08);
    }
    .title{font-size:18px; font-weight:700; margin:0 0 8px}
    .grid{display:grid; grid-template-columns:180px 1fr; row-gap:8px}
    .label{color:#555}
    .value{font-weight:600}
    .temp{font-size:40px; font-weight:800; margin:8px 0 16px}
    .muted{color:#777; font-size:14px; margin-top:8px}
    .error{color:#b00020; font-weight:600; margin-top:10px}
  </style>
</head>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <div class="wrap">
    <div class="search">
      <input id="q" type="text" placeholder="Cari lokasi (contoh: Yogyakarta, Bandung, 'Jakarta Selatan')" />
      <button id="btn">Cari</button>
    </div>

    <div id="tampilan" class="card" aria-live="polite">
      <p class="muted">Ketik lokasi lalu tekan <b>Cari</b> atau Enter.</p>
    </div>
    <p id="lokasi" class="muted"></p>
  </div>

  <script>
    // NOTE: pakai HTTPS biar gak kena mixed-content error
    const API_KEY = "5c17df9cdb59443894363944250810";
    const $q = $("#q");
    const $btn = $("#btn");
    const $panel = $("#tampilan");
    const $lokasi = $("#lokasi");

    function renderLoading() {
      $panel.html(`<p class="muted">Mengambil data…</p>`);
      $lokasi.text("");
    }

    function renderError(msg) {
      $panel.html(`<div class="error">Gagal memuat: ${msg}</div>`);
      $lokasi.text("");
    }

    function renderResult(data){
      const loc = data.location || {};
      const cur = data.current || {};

      // WeatherAPI: location.country, location.region, location.name, location.lat, location.lon
      const country = loc.country ?? "-";
      const region  = loc.region ?? "-"; // provinsi / region
      const name    = loc.name ?? "-";   // kota/area (bisa treat sbg “kota/kecamatan” tergantung granularitas dari API)
      const lat     = (loc.lat ?? "-");
      const lon     = (loc.lon ?? "-");
      const tempC   = (cur.temp_c ?? "-");

      $panel.html(`
        <h3 class="title">Lokasi: ${name}</h3>
        <div class="temp">${tempC}°C</div>
        <div class="grid">
          <div class="label">Negara</div>      <div class="value">${country}</div>
          <div class="label">Provinsi/Region</div><div class="value">${region}</div>
          <div class="label">Kota/Area</div>   <div class="value">${name}</div>
          <div class="label">Latitude</div>    <div class="value">${lat}</div>
          <div class="label">Longitude</div>   <div class="value">${lon}</div>
        </div>
        <p class="muted">Catatan: WeatherAPI tidak menyediakan field “kecamatan” spesifik; 
        biasanya <b>Kota/Area</b> di atas adalah nama kota/distrik yang paling relevan.</p>
      `);

      $lokasi.text(`${name}, ${region}, ${country}`);
    }

    function search(q){
      if(!q || !q.trim()){
        renderError("Lokasi kosong.");
        return;
      }
      renderLoading();

      const url = `https://api.weatherapi.com/v1/current.json?key=${API_KEY}&q=${encodeURIComponent(q)}&aqi=no`;
      $.ajax({
        url: url,
        method: "GET",
        success: function(data){
          renderResult(data);
          // Simpan query terakhir di URL hash biar gampang reload
          location.hash = encodeURIComponent(q);
        },
        error: function(xhr){
          let msg = "Periksa koneksi atau nama lokasi.";
          if (xhr && xhr.responseJSON && xhr.responseJSON.error && xhr.responseJSON.error.message){
            msg = xhr.responseJSON.error.message;
          }
          renderError(msg);
        }
      });
    }

    // Event handlers
    $btn.on("click", () => search($q.val()));
    $q.on("keydown", (e) => {
      if (e.key === "Enter") search($q.val());
    });

    // Auto-run dari hash jika ada (mis. share link)
    if (location.hash.length > 1){
      const initial = decodeURIComponent(location.hash.slice(1));
      $q.val(initial);
      search(initial);
    }
  </script>
</body>
</html>
