<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cek Cuaca - Dark Glass Style</title>

  <!-- Hubungkan ke CSS eksternal -->
  <link rel="stylesheet" href="style.css">

  <!-- jQuery CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="search">
      <input id="q" type="text" placeholder="Cari lokasi (contoh: Yogyakarta, Bandung, 'Jakarta Selatan')" />
      <button id="btn">Cari</button>
    </div>

    <div id="tampilan" class="card" aria-live="polite">
      <p class="muted">Ketik lokasi lalu tekan <b>Cari</b> atau Enter.</p>
    </div>

    <p id="lokasi" class="muted"></p>
  </div>

  <script>
    const API_KEY = "5c17df9cdb59443894363944250810";
    const $q = $("#q");
    const $btn = $("#btn");
    const $panel = $("#tampilan");
    const $lokasi = $("#lokasi");

    function renderLoading() {
      $panel.html(`<p class="muted">Mengambil data…</p>`);
      $lokasi.text("");
    }

    function renderError(msg) {
      $panel.html(`<div class="error">Gagal memuat: ${msg}</div>`);
      $lokasi.text("");
    }

    function renderResult(data){
      const loc = data.location || {};
      const cur = data.current || {};

      const country = loc.country ?? "-";
      const region  = loc.region ?? "-";
      const name    = loc.name ?? "-";
      const lat     = (loc.lat ?? "-");
      const lon     = (loc.lon ?? "-");
      const tempC   = (cur.temp_c ?? "-");

      $panel.html(`
        <h3 class="title">Lokasi: ${name}</h3>
        <div class="temp">${tempC}°C</div>
        <div class="grid">
          <div class="label">Negara</div>      <div class="value">${country}</div>
          <div class="label">Provinsi/Region</div><div class="value">${region}</div>
          <div class="label">Kota/Area</div>   <div class="value">${name}</div>
          <div class="label">Latitude</div>    <div class="value">${lat}</div>
          <div class="label">Longitude</div>   <div class="value">${lon}</div>
        </div>
        <p class="muted">Catatan: WeatherAPI tidak menyediakan field “kecamatan” spesifik; 
        biasanya <b>Kota/Area</b> di atas adalah nama kota/distrik yang paling relevan.</p>
      `);

      $lokasi.text(`${name}, ${region}, ${country}`);
    }

    function search(q){
      if(!q || !q.trim()){
        renderError("Lokasi kosong.");
        return;
      }
      renderLoading();

      const url = `https://api.weatherapi.com/v1/current.json?key=${API_KEY}&q=${encodeURIComponent(q)}&aqi=no`;
      $.ajax({
        url: url,
        method: "GET",
        success: function(data){
          renderResult(data);
          location.hash = encodeURIComponent(q);
        },
        error: function(xhr){
          let msg = "Periksa koneksi atau nama lokasi.";
          if (xhr && xhr.responseJSON && xhr.responseJSON.error && xhr.responseJSON.error.message){
            msg = xhr.responseJSON.error.message;
          }
          renderError(msg);
        }
      });
    }

    $btn.on("click", () => search($q.val()));
    $q.on("keydown", (e) => {
      if (e.key === "Enter") search($q.val());
    });

    if (location.hash.length > 1){
      const initial = decodeURIComponent(location.hash.slice(1));
      $q.val(initial);
      search(initial);
    }
  </script>
</body>
</html>
